# 读书签到应用 - 完整开发文档

## 项目概述

已完成读书签到应用的前后端开发，包括读书内容管理和读书签到管理两个核心功能。

## 已创建的文件

### 后端文件

```
backend/wenyuan/
├── models.py                    # 数据模型（已完善）
├── serializers.py               # 序列化器（新建）
├── views.py                    # 视图（已完善）
├── urls.py                     # 路由配置（新建）
├── fixtures/
│   └── init_menu.json         # 菜单初始化数据（新建）
├── management/
│   └── commands/
│       └── init_wenyuan_menu.py  # 菜单初始化命令（新建）
└── README.md                   # 应用说明文档（新建）
```

### 前端文件

```
web/src/views/wenyuan/
├── readContent/                # 读书内容模块
│   ├── api.ts                # API 接口（新建）
│   ├── crud.tsx              # CRUD 配置（新建）
│   └── index.vue             # 页面组件（新建）
└── readSign/                  # 读书签到模块
    ├── api.ts                # API 接口（新建）
    ├── crud.tsx              # CRUD 配置（新建）
    └── index.vue             # 页面组件（新建）
```

## 核心功能

### 1. 读书内容管理

**功能**：
- 新增读书内容（读书日期、读书内容）
- 编辑读书内容
- 删除读书内容
- 查询读书内容列表

**字段**：
- 读书日期（8位字符）
- 读书内容（最多5000字符）
- 创建时间（自动）
- 更新时间（自动）

### 2. 读书签到管理

**功能**：
- 批量添加签到人员（支持解析格式化文本）
- 编辑签到记录
- 删除签到记录
- 查询签到列表

**字段**：
- 读书内容（外键关联）
- 读书人员（姓名）
- 排名序号（数字）
- 创建时间（自动）
- 更新时间（自动）

**批量添加功能**：
- 自动解析签到人员格式：`序号.姓名`
- 支持一次性添加多个人员
- 示例：`1.杨艳2.刘艾英3.杨熙英4.周小鸥...`

## 安装部署步骤

### 步骤1：注册应用

编辑 `backend/application/settings.py`，在 `INSTALLED_APPS` 中添加：

```python
INSTALLED_APPS = [
    # ... 其他应用
    "wenyuan",
]
```

### 步骤2：创建数据库迁移

```bash
cd backend
python3 manage.py makemigrations wenyuan
python3 manage.py migrate
```

### 步骤3：初始化菜单数据

```bash
cd backend
python3 manage.py init_wenyuan_menu
```

### 步骤4：为角色分配菜单权限

1. 登录系统
2. 进入「系统管理」→「角色管理」
3. 点击某个角色的「权限配置」按钮
4. 在左侧菜单树中勾选「文苑管理」及其子菜单
5. 点击保存

### 步骤5：为角色分配按钮权限

1. 在权限配置页面中，点击「读书内容」菜单
2. 在右侧「接口权限」标签页中勾选需要的按钮权限
3. 点击「读书签到」菜单
4. 在右侧「接口权限」标签页中勾选需要的按钮权限
5. 点击保存

### 步骤6：重新登录

**重要**：权限配置后必须重新登录才能生效！

## 使用说明

### 读书内容管理

1. 进入「文苑管理」→「读书内容」
2. 点击「新增」按钮
3. 填写表单：
   - 读书日期：如 `20250126`
   - 读书内容：输入读书的具体内容
4. 点击「确定」保存

### 读书签到管理

#### 方法1：批量添加（推荐）

1. 进入「文苑管理」→「读书签到」
2. 点击「批量添加签到」按钮
3. 在弹出的对话框中：
   - 选择读书内容（从下拉列表中选择）
   - 输入签到人员，格式为：`序号.姓名`
   - 例如：`1.杨艳2.刘艾英3.杨熙英4.周小鸥 5.马小平...`
4. 点击「确定」，系统会自动解析并创建多条签到记录

#### 方法2：逐条添加

1. 点击「新增」按钮
2. 填写表单：
   - 读书内容：选择对应的读书内容
   - 读书人员：输入人员姓名
   - 排名序号：输入排名数字
3. 点击「确定」保存

## 签到人员格式说明

### 标准格式

```
序号.姓名序号.姓名序号.姓名...
```

### 示例

```
1.杨艳2.刘艾英3.杨熙英4.周小鸥 5.马小平6.韩歌军7.谭雁红8.赵艳香9.张迎春10.常风仙11.赵红12.韩果香13.张慧14.梁文喜15.李瑞珍16.李普17.润兰18.刘剑勇19.白莉20.何晓英21.李淑玲22.谷润贞23.陶琳24.段燕文25胡秀英26.李小玲27.何雯曈28.王虹29.刘春英30.王改萍31.田琦琪32.吕蕴颖33.李效中34.申见先35.史艳红36.纪霞东37.武卫岗38.申太仙39.孙丽君40.马聚会41.李海军42.谢锋辉43.王朝阳44.赵建华45.梁艳46.段宣刚47.赵育新48.史鹏飞49.邢燕50.
```

### 格式要求

- 序号必须是数字
- 姓名不能包含数字
- 多个人之间不需要分隔符，直接连接
- 序号和姓名之间用英文点号（.）分隔

## API 接口文档

### 读书内容接口

| 方法 | 路径 | 说明 | 权限 |
|------|--------|------|--------|
| GET | /api/wenyuan/read_content/ | 查询列表 | readContent:Search |
| GET | /api/wenyuan/read_content/{id}/ | 获取详情 | readContent:Retrieve |
| POST | /api/wenyuan/read_content/ | 新增 | readContent:Create |
| PUT | /api/wenyuan/read_content/{id}/ | 修改 | readContent:Update |
| DELETE | /api/wenyuan/read_content/{id}/ | 删除 | readContent:Delete |

### 读书签到接口

| 方法 | 路径 | 说明 | 权限 |
|------|--------|------|--------|
| GET | /api/wenyuan/read_sign/ | 查询列表 | readSign:Search |
| GET | /api/wenyuan/read_sign/{id}/ | 获取详情 | readSign:Retrieve |
| POST | /api/wenyuan/read_sign/ | 新增 | readSign:Create |
| PUT | /api/wenyuan/read_sign/{id}/ | 修改 | readSign:Update |
| DELETE | /api/wenyuan/read_sign/{id}/ | 删除 | readSign:Delete |

## 数据库表结构

### read_content（读书内容表）

| 字段名 | 类型 | 长度 | 允许空 | 说明 |
|--------|------|--------|--------|------|
| id | Integer | - | 否 | 主键 |
| read_date | Char | 8 | 否 | 读书日期 |
| read_content | Char | 5000 | 否 | 读书内容 |
| create_datetime | DateTime | - | 否 | 创建时间 |
| update_datetime | DateTime | - | 否 | 更新时间 |

### read_sign（读书签到表）

| 字段名 | 类型 | 长度 | 允许空 | 说明 |
|--------|------|--------|--------|------|
| id | Integer | - | 否 | 主键 |
| read_content_id | Integer | - | 否 | 读书内容ID（外键） |
| read_person | Char | 50 | 否 | 读书人员姓名 |
| rank | Integer | - | 否 | 排名序号 |
| create_datetime | DateTime | - | 否 | 创建时间 |
| update_datetime | DateTime | - | 否 | 更新时间 |

## 常见问题

### Q1: 找不到「文苑管理」菜单？

**A**: 请按以下步骤检查：

1. 是否运行了菜单初始化命令：
   ```bash
   python3 manage.py init_wenyuan_menu
   ```

2. 当前用户的角色是否被分配了「文苑管理」菜单权限

3. 是否重新登录了系统（权限配置后必须重新登录）

### Q2: 批量添加签到失败？

**A**: 请检查：

1. 签到人员格式是否正确（序号.姓名）
2. 是否选择了读书内容
3. 当前用户是否有新增签到的权限（`readSign:Create`）

### Q3: 数据库迁移失败？

**A**: 请检查：

1. 应用是否已在 `INSTALLED_APPS` 中注册
2. 数据库连接是否正常
3. 是否有权限修改数据库

### Q4: 接口返回权限错误？

**A**: 请检查：

1. 角色是否被分配了对应的按钮权限
2. 是否重新登录了系统
3. 权限标识是否正确（`readContent:Search`、`readSign:Create` 等）

## 技术栈

### 后端
- Django 3.2
- Django REST Framework
- PostgreSQL/MySQL

### 前端
- Vue 3
- TypeScript
- Element Plus
- FastCrud

## 扩展建议

1. **签到统计**：统计每个人签到的次数、出勤率等
2. **数据导出**：将签到记录导出为 Excel 文件
3. **签到提醒**：定时提醒用户签到
4. **签到照片**：支持上传签到时的照片
5. **签到时间**：记录具体的签到时间
6. **数据可视化**：使用图表展示签到数据

## 维护说明

### 修改模型后

```bash
python3 manage.py makemigrations wenyuan
python3 manage.py migrate
```

### 修改菜单后

```bash
python3 manage.py init_wenyuan_menu
```

### 重新部署前端

```bash
cd web
npm run build
```

## 联系方式

如有问题，请查看：
- 应用文档：`backend/wenyuan/README.md`
- Django 文档：https://docs.djangoproject.com/
- DRF 文档：https://www.django-rest-framework.org/

---

**开发完成日期**：2025-01-26
**版本**：v1.0.0
